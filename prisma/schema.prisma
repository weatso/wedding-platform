generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// --- 1. ENUM & ROLE (BARU) ---
enum Role {
  DEVELOPER
  ADMIN
  CLIENT
}

enum RsvpStatus {
  PENDING
  ATTENDING
  DECLINED
}

// --- 2. MODEL USER (BARU) ---
model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String   // Nanti akan kita hash
  role      Role     @default(CLIENT)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relasi: Satu User bisa memiliki banyak Undangan
  invitations Invitation[]
}

// --- 3. MODEL INVITATION (UPDATE RELASI) ---
model Invitation {
  id            String   @id @default(uuid())
  slug          String   @unique 
  
  // Data Mempelai
  groomName     String
  groomNickname String
  groomFather   String
  groomMother   String
  
  brideName     String
  brideNickname String
  brideFather   String
  brideMother   String
  
  // Data Acara
  eventDate     DateTime
  eventTime     String
  locationName  String
  locationAddress String
  mapUrl        String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // --- RELASI KE USER (BARU) ---
  // Kita buat optional (?) dulu agar data lama (Romeo Juliet) tidak error
  userId        String?  
  user          User?    @relation(fields: [userId], references: [id])

  // Relasi ke Guest
  guests        Guest[]
}

// --- 4. MODEL GUEST (TETAP) ---
model Guest {
  id            String   @id @default(uuid())
  name          String
  category      String   @default("Reguler")
  phoneNumber   String?  
  
  rsvpStatus    RsvpStatus @default(PENDING)
  
  qrCode        String   @unique @default(uuid())
  checkInTime   DateTime? 
  
  invitationId  String
  invitation    Invitation @relation(fields: [invitationId], references: [id])

  createdAt     DateTime @default(now())
}